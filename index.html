<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Die Metallbindung – Interaktive Lernumgebung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                        success: { 50: '#f0fdf4', 100: '#dcfce7', 500: '#22c55e', 600: '#16a34a', 700: '#15803d' },
                        danger: { 50: '#fef2f2', 100: '#fee2e2', 500: '#ef4444', 600: '#dc2626' }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .progress-bar-fill { transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .option-btn { transition: all 0.2s ease; }
        .option-btn:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .option-btn:disabled { cursor: default; }
        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }
        .pulse-green { animation: pulseGreen 0.6s ease; }
        @keyframes pulseGreen { 0%{box-shadow:0 0 0 0 rgba(34,197,94,0.5)} 100%{box-shadow:0 0 0 12px rgba(34,197,94,0)} }
        canvas { border-radius: 12px; }
        @media print {
            .no-print { display: none !important; }
            .print-break { page-break-before: always; }
            body { font-size: 11pt; }
            .shadow-lg, .shadow-md, .shadow-sm { box-shadow: none !important; }
            canvas { border: 1px solid #ccc; }
        }
        .gap-input {
            border: none;
            border-bottom: 2px solid #93c5fd;
            background: #eff6ff;
            outline: none;
            padding: 2px 8px;
            font-weight: 500;
            border-radius: 4px 4px 0 0;
            transition: border-color 0.2s, background 0.2s;
            min-width: 120px;
            text-align: center;
        }
        .gap-input:focus { border-bottom-color: #2563eb; background: #dbeafe; }
        .gap-input.correct { border-bottom-color: #16a34a; background: #dcfce7; color: #15803d; }
        .gap-input.almost { border-bottom-color: #ca8a04; background: #fef9c3; color: #854d0e; }
        .gap-input.incorrect { border-bottom-color: #dc2626; background: #fee2e2; color: #dc2626; }
        .gap-input:disabled { opacity: 1; }
        .gap-hint { font-size: 0.7rem; color: #854d0e; font-weight: 500; margin-left: 4px; white-space: nowrap; }
        .section-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.04);
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header & Progress -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200 no-print">
        <div class="max-w-4xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 bg-primary-600 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/></svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-gray-900">Die Metallbindung</h1>
                        <p class="text-xs text-gray-500">Interaktive Lernumgebung</p>
                    </div>
                </div>
                <button onclick="window.print()" class="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0021 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 00-1.913-.247M6.34 18H5.25A2.25 2.25 0 013 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 011.913-.247m0 0a48.103 48.103 0 0114.5 0m-14.5 0V5.256a2.25 2.25 0 012.25-2.25h9a2.25 2.25 0 012.25 2.25v3.498"/></svg>
                    Ergebnis speichern
                </button>
            </div>
            <div class="flex items-center gap-3">
                <div class="flex-1 h-2.5 bg-gray-100 rounded-full overflow-hidden">
                    <div id="progressBar" class="progress-bar-fill h-full bg-gradient-to-r from-primary-500 to-primary-600 rounded-full" style="width: 0%"></div>
                </div>
                <span id="progressText" class="text-sm font-semibold text-primary-600 min-w-[3rem] text-right">0 %</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 py-8">

        <!-- Intro -->
        <div class="section-card fade-in">
            <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center flex-shrink-0 mt-0.5">
                    <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/></svg>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-gray-900 mb-1">Willkommen!</h2>
                    <p class="text-gray-600 leading-relaxed">
                        In dieser interaktiven Lernumgebung erforschst du die <strong>Metallbindung</strong> und das <strong>Elektronengasmodell</strong>.
                        Bearbeite die Aufgaben der Reihe nach, erhalte sofortiges Feedback und beobachte deinen Fortschritt oben im Balken.
                    </p>
                </div>
            </div>
        </div>

        <!-- Info-Text (collapsible) -->
        <div class="section-card fade-in">
            <button onclick="toggleSection('infoText')" class="w-full flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/></svg>
                    </div>
                    <h2 class="text-lg font-bold text-gray-900">Grundlagentext: Die metallische Bindung</h2>
                </div>
                <svg id="infoTextChevron" class="w-5 h-5 text-gray-400 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/></svg>
            </button>
            <div id="infoText" class="mt-4 text-gray-700 leading-relaxed space-y-4">
                <p>Die meisten Elemente sind Metalle. Alle Metalle leiten die Elektrizit&auml;t sowohl im festen als auch im fl&uuml;ssigen Zustand und sind <strong>duktil</strong> (verformbar, schmiedbar).</p>
                <p>Metall-Atome geben relativ leicht ihre <strong>Au&szlig;enelektronen (Valenzelektronen)</strong> ab. Im <strong>Elektronengasmodell</strong> geht man davon aus, dass jedes Metall-Atom seine Au&szlig;enelektronen &bdquo;abgegeben&ldquo; hat. Die nun positiv geladenen Metall-Ionen sind in einem regelm&auml;&szlig;igen Gitter, dem sogenannten <strong>Metallgitter</strong>, angeordnet.</p>
                <p>Die &bdquo;abgegebenen&ldquo; Au&szlig;enelektronen aller Metall-Atome bewegen sich innerhalb dieses Gitters frei zwischen allen Metall-Ionen und bilden das sogenannte <strong>&bdquo;Elektronengas&ldquo;</strong>.</p>
                <p>Die elektrostatischen Anziehungskr&auml;fte zwischen den positiv geladenen Metall-Ionen und den negativ geladenen Elektronen sorgen f&uuml;r den Zusammenhalt &ndash; man spricht von der <strong>metallischen Bindung</strong>.</p>
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 text-sm">
                    <p class="font-semibold text-amber-800 mb-1">Vergleich: Lithium &amp; Beryllium</p>
                    <p class="text-amber-700">Lithium-Metall wird durch <strong>ein Elektron</strong> je positives Ion zusammengehalten, Beryllium durch <strong>zwei Elektronen</strong>. Die zus&auml;tzlichen Elektronen bewirken, dass Beryllium ein <strong>h&auml;rteres</strong> Metall als Lithium ist.</p>
                </div>
            </div>
        </div>

        <!-- ======================== -->
        <!--  AUFGABE 1: Multiple Choice -->
        <!-- ======================== -->
        <div class="section-card fade-in" id="q1-card">
            <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-bold text-primary-600 bg-primary-50 px-2.5 py-1 rounded-full">Aufgabe 1</span>
                <span class="text-xs text-gray-400">Multiple Choice</span>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Was versteht man unter dem Elektronengasmodell?</h3>
            <div id="q1-options" class="grid gap-3">
                <button onclick="checkMC('q1', 0)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    A) Elektronen werden fest an einzelne Atome gebunden und k&ouml;nnen sich nicht bewegen.
                </button>
                <button onclick="checkMC('q1', 1)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    B) Metall-Atome geben ihre Valenzelektronen ab; diese bewegen sich frei im Metallgitter und bilden das &bdquo;Elektronengas&ldquo;.
                </button>
                <button onclick="checkMC('q1', 2)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    C) Metall-Atome teilen sich Elektronenpaare wie bei einer kovalenten Bindung.
                </button>
                <button onclick="checkMC('q1', 3)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    D) Positive und negative Ionen ziehen sich in einem Ionengitter an.
                </button>
            </div>
            <div id="q1-feedback" class="mt-4 hidden"></div>
        </div>

        <!-- ======================== -->
        <!--  AUFGABE 2: Multiple Choice -->
        <!-- ======================== -->
        <div class="section-card fade-in" id="q2-card">
            <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-bold text-primary-600 bg-primary-50 px-2.5 py-1 rounded-full">Aufgabe 2</span>
                <span class="text-xs text-gray-400">Multiple Choice</span>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Warum ist Beryllium h&auml;rter als Lithium?</h3>
            <div id="q2-options" class="grid gap-3">
                <button onclick="checkMC('q2', 0)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    A) Beryllium hat gr&ouml;&szlig;ere Atome als Lithium.
                </button>
                <button onclick="checkMC('q2', 1)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    B) Beryllium gibt zwei Valenzelektronen pro Atom ab, was zu st&auml;rkeren Anziehungskr&auml;ften f&uuml;hrt.
                </button>
                <button onclick="checkMC('q2', 2)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    C) Beryllium bildet kovalente Bindungen statt metallischer.
                </button>
                <button onclick="checkMC('q2', 3)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    D) Lithium hat mehr Protonen und st&ouml;&szlig;t die Ionen st&auml;rker ab.
                </button>
            </div>
            <div id="q2-feedback" class="mt-4 hidden"></div>
        </div>

        <!-- ======================== -->
        <!--  AUFGABE 3: Multiple Choice -->
        <!-- ======================== -->
        <div class="section-card fade-in" id="q3-card">
            <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-bold text-primary-600 bg-primary-50 px-2.5 py-1 rounded-full">Aufgabe 3</span>
                <span class="text-xs text-gray-400">Multiple Choice</span>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Warum leiten Metalle den elektrischen Strom?</h3>
            <div id="q3-options" class="grid gap-3">
                <button onclick="checkMC('q3', 0)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    A) Weil die Metall-Ionen sich frei bewegen k&ouml;nnen.
                </button>
                <button onclick="checkMC('q3', 1)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    B) Weil die Elektronen fest an die Atome gebunden sind und Energie &uuml;bertragen.
                </button>
                <button onclick="checkMC('q3', 2)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    C) Weil die frei beweglichen Elektronen (Elektronengas) Ladung transportieren k&ouml;nnen.
                </button>
                <button onclick="checkMC('q3', 3)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    D) Weil Metalle keine Elektronen besitzen und Protonen den Strom leiten.
                </button>
            </div>
            <div id="q3-feedback" class="mt-4 hidden"></div>
        </div>

        <!-- ======================== -->
        <!--  AUFGABE 4: Multiple Choice -->
        <!-- ======================== -->
        <div class="section-card fade-in" id="q4-card">
            <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-bold text-primary-600 bg-primary-50 px-2.5 py-1 rounded-full">Aufgabe 4</span>
                <span class="text-xs text-gray-400">Multiple Choice</span>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Was bedeutet &bdquo;Duktilit&auml;t&ldquo; bei Metallen?</h3>
            <div id="q4-options" class="grid gap-3">
                <button onclick="checkMC('q4', 0)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    A) Metalle k&ouml;nnen Licht reflektieren.
                </button>
                <button onclick="checkMC('q4', 1)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    B) Metalle sind verformbar und schmiedbar.
                </button>
                <button onclick="checkMC('q4', 2)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    C) Metalle l&ouml;sen sich leicht in Wasser.
                </button>
                <button onclick="checkMC('q4', 3)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    D) Metalle sind immer fl&uuml;ssig bei Raumtemperatur.
                </button>
            </div>
            <div id="q4-feedback" class="mt-4 hidden"></div>
        </div>

        <!-- ======================== -->
        <!--  AUFGABE 5: Lückentext -->
        <!-- ======================== -->
        <div class="section-card fade-in" id="q5-card">
            <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-bold text-primary-600 bg-primary-50 px-2.5 py-1 rounded-full">Aufgabe 5</span>
                <span class="text-xs text-gray-400">L&uuml;ckentext</span>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Erg&auml;nze die fehlenden Begriffe zur Metallbindung.</h3>
            <div class="bg-gray-50 rounded-xl p-6 leading-loose text-gray-700">
                <p class="mb-4">
                    Metall-Atome geben relativ leicht ihre
                    <input type="text" id="gap1" class="gap-input" placeholder="?" style="width:160px" autocomplete="off">
                    ab. Die positiv geladenen Metall-Ionen ordnen sich in einem regelm&auml;&szlig;igen
                    <input type="text" id="gap2" class="gap-input" placeholder="?" style="width:140px" autocomplete="off">
                    an.
                </p>
                <p class="mb-4">
                    Die abgegebenen Elektronen bewegen sich frei und bilden das sogenannte
                    <input type="text" id="gap3" class="gap-input" placeholder="?" style="width:160px" autocomplete="off">.
                </p>
                <p class="mb-4">
                    Die
                    <input type="text" id="gap4" class="gap-input" placeholder="?" style="width:190px" autocomplete="off">
                    Anziehungskr&auml;fte zwischen Ionen und Elektronen sorgen f&uuml;r den Zusammenhalt. Man spricht von der
                    <input type="text" id="gap5" class="gap-input" placeholder="?" style="width:190px" autocomplete="off">.
                </p>
            </div>
            <div class="flex flex-wrap gap-3 mt-4 no-print">
                <button id="q5-checkBtn" onclick="checkGapText()" class="px-6 py-2.5 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors text-sm">
                    Antworten pr&uuml;fen
                </button>
                <button id="q5-retryBtn" onclick="retryGapText('q5')" class="px-6 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors text-sm hidden">
                    Nochmal versuchen
                </button>
            </div>
            <div id="q5-feedback" class="mt-4 hidden"></div>
        </div>

        <!-- ======================== -->
        <!--  AUFGABE 6: Lückentext 2 -->
        <!-- ======================== -->
        <div class="section-card fade-in" id="q6-card">
            <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-bold text-primary-600 bg-primary-50 px-2.5 py-1 rounded-full">Aufgabe 6</span>
                <span class="text-xs text-gray-400">L&uuml;ckentext</span>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Lithium &amp; Beryllium im Vergleich</h3>
            <div class="bg-gray-50 rounded-xl p-6 leading-loose text-gray-700">
                <p class="mb-4">
                    Lithium-Metall wird durch
                    <input type="text" id="gap6" class="gap-input" placeholder="?" style="width:100px" autocomplete="off">
                    Elektron(en) je Ion zusammengehalten, Beryllium durch
                    <input type="text" id="gap7" class="gap-input" placeholder="?" style="width:100px" autocomplete="off">
                    Elektron(en).
                </p>
                <p>
                    Deshalb ist Beryllium ein
                    <input type="text" id="gap8" class="gap-input" placeholder="?" style="width:130px" autocomplete="off">
                    Metall als Lithium. Die Elektronen im Metall sind vollst&auml;ndig
                    <input type="text" id="gap9" class="gap-input" placeholder="?" style="width:150px" autocomplete="off">.
                </p>
            </div>
            <div class="flex flex-wrap gap-3 mt-4 no-print">
                <button id="q6-checkBtn" onclick="checkGapText2()" class="px-6 py-2.5 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors text-sm">
                    Antworten pr&uuml;fen
                </button>
                <button id="q6-retryBtn" onclick="retryGapText('q6')" class="px-6 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors text-sm hidden">
                    Nochmal versuchen
                </button>
            </div>
            <div id="q6-feedback" class="mt-4 hidden"></div>
        </div>

        <!-- ======================== -->
        <!--  AUFGABE 7: MC Duktilität -->
        <!-- ======================== -->
        <div class="section-card fade-in" id="q7-card">
            <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-bold text-primary-600 bg-primary-50 px-2.5 py-1 rounded-full">Aufgabe 7</span>
                <span class="text-xs text-gray-400">Multiple Choice</span>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Wie erkl&auml;rt das Elektronengasmodell die Verformbarkeit (Duktilit&auml;t) von Metallen?</h3>
            <div id="q7-options" class="grid gap-3">
                <button onclick="checkMC('q7', 0)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    A) Die Metall-Ionen k&ouml;nnen gegeneinander verschoben werden, weil das Elektronengas den Zusammenhalt auch in neuer Position aufrechterhalt.
                </button>
                <button onclick="checkMC('q7', 1)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    B) Die Ionen sind so klein, dass sie sich nicht gegenseitig behindern.
                </button>
                <button onclick="checkMC('q7', 2)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    C) Die kovalenten Bindungen brechen leicht und bilden sich sofort neu.
                </button>
                <button onclick="checkMC('q7', 3)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    D) Metalle bestehen aus Molek&uuml;len, die sich aneinander vorbei bewegen.
                </button>
            </div>
            <div id="q7-feedback" class="mt-4 hidden"></div>
        </div>

        <!-- ======================== -->
        <!--  AUFGABE 8: MC Zusammenhalt -->
        <!-- ======================== -->
        <div class="section-card fade-in" id="q8-card">
            <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-bold text-primary-600 bg-primary-50 px-2.5 py-1 rounded-full">Aufgabe 8</span>
                <span class="text-xs text-gray-400">Multiple Choice</span>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Was w&uuml;rde passieren, wenn man die Elektronen aus einem Metall entfernen k&ouml;nnte?</h3>
            <div id="q8-options" class="grid gap-3">
                <button onclick="checkMC('q8', 0)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    A) Das Metall w&uuml;rde fl&uuml;ssig werden.
                </button>
                <button onclick="checkMC('q8', 1)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    B) Nichts, die Ionen halten auch ohne Elektronen zusammen.
                </button>
                <button onclick="checkMC('q8', 2)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    C) Die positiven Ionen w&uuml;rden sich gegenseitig absto&szlig;en und das Metall w&uuml;rde &bdquo;auseinanderfliegen&ldquo;.
                </button>
                <button onclick="checkMC('q8', 3)" class="option-btn text-left px-5 py-3.5 rounded-xl border-2 border-gray-200 bg-white hover:border-primary-300 hover:bg-primary-50 font-medium text-gray-700 transition-all">
                    D) Das Metall w&uuml;rde zu einem Gas werden.
                </button>
            </div>
            <div id="q8-feedback" class="mt-4 hidden"></div>
        </div>

        <!-- ======================== -->
        <!--  SIMULATION -->
        <!-- ======================== -->
        <div class="section-card fade-in print-break" id="sim-card">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"/></svg>
                </div>
                <div>
                    <h2 class="text-lg font-bold text-gray-900">Das Elektronengas-Modell</h2>
                    <p class="text-sm text-gray-500">Interaktive Simulation</p>
                </div>
            </div>
            <p class="text-gray-600 text-sm mb-4">
                Klicke auf <strong>&bdquo;Simulation starten&ldquo;</strong>, um zu sehen, wie sich die frei beweglichen Elektronen
                <span class="text-blue-600 font-medium">(blaue Punkte)</span> zwischen den festen, positiv geladenen Atomr&uuml;mpfen
                <span class="text-red-500 font-medium">(rote Kreise mit +)</span> bewegen.
            </p>
            <div class="bg-gray-900 rounded-2xl p-1 mb-4">
                <canvas id="simCanvas" width="800" height="420" class="w-full rounded-xl" style="max-height: 420px;"></canvas>
            </div>
            <div class="flex flex-wrap gap-3 no-print">
                <button id="simStartBtn" onclick="toggleSimulation()" class="px-5 py-2.5 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors text-sm flex items-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    Simulation starten
                </button>
                <button onclick="resetSimulation()" class="px-5 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors text-sm">
                    Zur&uuml;cksetzen
                </button>
            </div>
            <div class="mt-4 flex flex-wrap gap-6 text-sm text-gray-500">
                <span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-400 inline-block"></span> Positive Metall-Ionen (fest)</span>
                <span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-blue-400 inline-block"></span> Frei bewegliche Elektronen</span>
            </div>
        </div>

        <!-- Completion Message -->
        <div id="completionMessage" class="section-card fade-in hidden">
            <div class="text-center py-6">
                <div class="w-16 h-16 bg-success-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-success-600" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Gl&uuml;ckwunsch!</h2>
                <p class="text-gray-600 mb-4">Du hast alle Aufgaben zur Metallbindung erfolgreich bearbeitet.</p>
                <button onclick="window.print()" class="px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-medium transition-colors no-print">
                    Ergebnis als PDF speichern
                </button>
            </div>
        </div>

    </main>

    <script>
    // =============================================
    //  STATE
    // =============================================
    const TOTAL_QUESTIONS = 8;
    const answeredCorrectly = new Set();

    const mcAnswers = {
        q1: { correct: 1, explanation: 'Im Elektronengasmodell geben die Metallatome ihre Valenzelektronen ab. Diese bewegen sich frei im Metallgitter und bilden das "Elektronengas".' },
        q2: { correct: 1, explanation: 'Beryllium gibt zwei Valenzelektronen pro Atom ab (Lithium nur eines). Mehr frei bewegliche Elektronen bedeuten stärkere Anziehungskräfte und damit ein härteres Metall.' },
        q3: { correct: 2, explanation: 'Die frei beweglichen Elektronen des Elektronengases können Ladung transportieren – deshalb leiten Metalle den elektrischen Strom.' },
        q4: { correct: 1, explanation: 'Duktilität bedeutet, dass Metalle verformbar und schmiedbar sind. Die Ionenschichten können gegeneinander verschoben werden, ohne dass die Bindung bricht.' },
        q7: { correct: 0, explanation: 'Beim Verformen verschieben sich die Ionenschichten gegeneinander. Das Elektronengas passt sich an und hält die Ionen auch in der neuen Position zusammen.' },
        q8: { correct: 2, explanation: 'Ohne das Elektronengas gäbe es nur positive Ionen, die sich elektrostatisch abstoßen. Das Metall würde „auseinanderfliegen", wie es im Originaltext beschrieben wird.' },
    };

    // Gap text answers: exact = perfect (green), acceptable = counts as correct but shows hint (yellow)
    // bestAnswer is the ideal term shown in hints
    const gap1Answers = {
        gap1: {
            exact: ['valenzelektronen', 'außenelektronen', 'aussenelektronen', 'valenz-elektronen', 'aussen-elektronen', 'außen-elektronen'],
            acceptable: ['elektronen', 'e-', 'die elektronen', 'ihre elektronen', 'die valenzelektronen', 'die außenelektronen', 'die aussenelektronen'],
            bestAnswer: 'Valenzelektronen (Außenelektronen)'
        },
        gap2: {
            exact: ['metallgitter', 'metall-gitter'],
            acceptable: ['gitter', 'einem gitter', 'kristallgitter', 'ionengitter', 'regelmäßigen gitter', 'regelmaessigen gitter'],
            bestAnswer: 'Metallgitter'
        },
        gap3: {
            exact: ['elektronengas', 'elektronen-gas', '"elektronengas"', '„elektronengas"'],
            acceptable: ['elektronenwolke', 'elektronensee', 'gas', 'das elektronengas'],
            bestAnswer: 'Elektronengas'
        },
        gap4: {
            exact: ['elektrostatischen', 'elektrostatische'],
            acceptable: ['anziehenden', 'elektrischen', 'elektrische', 'anziehungs', 'elektrostatisch', 'starken', 'starke'],
            bestAnswer: 'elektrostatischen'
        },
        gap5: {
            exact: ['metallischen bindung', 'metallische bindung', 'metallbindung', 'metall-bindung'],
            acceptable: ['bindung', 'der bindung', 'metalldindung', 'metallischer bindung'],
            bestAnswer: 'metallischen Bindung'
        },
    };
    const gap1Ids = ['gap1', 'gap2', 'gap3', 'gap4', 'gap5'];

    const gap2Answers = {
        gap6: {
            exact: ['ein', '1', 'eins', 'einem'],
            acceptable: ['eines', 'einziges', 'ein einziges'],
            bestAnswer: 'ein'
        },
        gap7: {
            exact: ['zwei', '2'],
            acceptable: ['doppelt so viele', 'doppelt so vielen', 'doppelt', 'zwei mal', 'zweimal'],
            bestAnswer: 'zwei'
        },
        gap8: {
            exact: ['härteres', 'harteres'],
            acceptable: ['festeres', 'stabileres', 'stärkeres', 'staerkeres', 'hartes', 'festes', 'stabiles', 'stärkeres'],
            bestAnswer: 'härteres'
        },
        gap9: {
            exact: ['delokalisiert', 'delocalisiert'],
            acceptable: ['frei beweglich', 'frei', 'beweglich', 'nicht lokalisiert', 'verteilt', 'frei beweglichen'],
            bestAnswer: 'delokalisiert'
        },
    };
    const gap2Ids = ['gap6', 'gap7', 'gap8', 'gap9'];

    // =============================================
    //  PROGRESS
    // =============================================
    function updateProgress() {
        const pct = Math.round((answeredCorrectly.size / TOTAL_QUESTIONS) * 100);
        document.getElementById('progressBar').style.width = pct + '%';
        document.getElementById('progressText').textContent = pct + ' %';
        if (answeredCorrectly.size === TOTAL_QUESTIONS) {
            document.getElementById('completionMessage').classList.remove('hidden');
            document.getElementById('completionMessage').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    // =============================================
    //  MULTIPLE CHOICE
    // =============================================
    function checkMC(qId, selected) {
        const data = mcAnswers[qId];
        const options = document.getElementById(qId + '-options');
        const buttons = options.querySelectorAll('button');
        const feedback = document.getElementById(qId + '-feedback');
        const isCorrect = selected === data.correct;

        buttons.forEach((btn, i) => {
            btn.disabled = true;
            btn.classList.remove('hover:border-primary-300', 'hover:bg-primary-50');
            if (i === data.correct) {
                btn.classList.remove('border-gray-200', 'bg-white');
                btn.classList.add('border-success-500', 'bg-success-50', 'text-success-700');
            } else if (i === selected && !isCorrect) {
                btn.classList.remove('border-gray-200', 'bg-white');
                btn.classList.add('border-danger-500', 'bg-danger-50', 'text-danger-600', 'shake');
            } else {
                btn.classList.add('opacity-50');
            }
        });

        feedback.classList.remove('hidden');
        if (isCorrect) {
            feedback.innerHTML = '<div class="flex items-start gap-3 p-4 bg-success-50 border border-success-200 rounded-xl pulse-green"><svg class="w-5 h-5 text-success-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg><div><p class="font-semibold text-success-700">Richtig!</p><p class="text-sm text-success-600 mt-1">' + data.explanation + '</p></div></div>';
            answeredCorrectly.add(qId);
        } else {
            feedback.innerHTML = '<div class="flex items-start gap-3 p-4 bg-danger-50 border border-danger-200 rounded-xl"><svg class="w-5 h-5 text-danger-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg><div><p class="font-semibold text-danger-600">Leider falsch.</p><p class="text-sm text-danger-500 mt-1">' + data.explanation + '</p></div></div>';
        }
        updateProgress();
    }

    // =============================================
    //  GAP TEXT HELPERS
    // =============================================
    function normalize(str) {
        return str.replace(/ä/g,'ae').replace(/ö/g,'oe').replace(/ü/g,'ue').replace(/ß/g,'ss');
    }
    function matchesAny(val, list) {
        return list.some(a => val === a || val === normalize(a));
    }
    function removeHints(ids) {
        for (const id of ids) {
            const input = document.getElementById(id);
            const next = input.nextElementSibling;
            if (next && next.classList.contains('gap-hint')) next.remove();
        }
    }
    function addHint(input, text) {
        // remove old hint if present
        const next = input.nextElementSibling;
        if (next && next.classList.contains('gap-hint')) next.remove();
        const hint = document.createElement('span');
        hint.className = 'gap-hint';
        hint.textContent = '(Genauer: ' + text + ')';
        input.parentNode.insertBefore(hint, input.nextSibling);
    }
    function addCorrection(input, text) {
        const next = input.nextElementSibling;
        if (next && next.classList.contains('gap-hint')) next.remove();
        const hint = document.createElement('span');
        hint.className = 'text-xs text-success-600 font-medium ml-1';
        hint.textContent = '→ ' + text;
        input.parentNode.insertBefore(hint, input.nextSibling);
    }

    // Generic gap checker: returns { exactCount, almostCount, wrongCount }
    function checkGaps(answersMap, ids) {
        let exactCount = 0, almostCount = 0, wrongCount = 0;
        for (const id of ids) {
            const data = answersMap[id];
            const input = document.getElementById(id);
            const val = input.value.trim().toLowerCase();
            input.classList.remove('correct', 'almost', 'incorrect');
            // remove old hints/corrections
            const next = input.nextElementSibling;
            if (next && (next.classList.contains('gap-hint') || next.classList.contains('text-xs'))) next.remove();

            if (matchesAny(val, data.exact)) {
                input.classList.add('correct');
                exactCount++;
            } else if (matchesAny(val, data.acceptable)) {
                input.classList.add('almost');
                almostCount++;
                addHint(input, data.bestAnswer);
            } else {
                input.classList.add('incorrect');
                wrongCount++;
                addCorrection(input, data.bestAnswer);
            }
        }
        return { exactCount, almostCount, wrongCount };
    }

    function buildFeedbackHTML(exactCount, almostCount, wrongCount, total, perfectMsg, qId) {
        const correctTotal = exactCount + almostCount;
        if (wrongCount === 0 && almostCount === 0) {
            // All perfect
            return '<div class="flex items-start gap-3 p-4 bg-success-50 border border-success-200 rounded-xl pulse-green">' +
                '<svg class="w-5 h-5 text-success-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>' +
                '<div><p class="font-semibold text-success-700">Perfekt! Alle ' + total + ' Lücken exakt richtig!</p>' +
                '<p class="text-sm text-success-600 mt-1">' + perfectMsg + '</p></div></div>';
        } else if (wrongCount === 0 && almostCount > 0) {
            // All correct but some only "almost"
            return '<div class="flex items-start gap-3 p-4 bg-amber-50 border border-amber-200 rounded-xl">' +
                '<svg class="w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>' +
                '<div><p class="font-semibold text-amber-700">Richtig! ' + exactCount + ' von ' + total + ' exakt, ' + almostCount + ' fast richtig.</p>' +
                '<p class="text-sm text-amber-600 mt-1">Deine Antworten zählen als korrekt. Die gelb markierten Felder zeigen dir den präziseren Fachbegriff.</p></div></div>';
        } else if (wrongCount > 0 && correctTotal > 0) {
            // Mixed
            return '<div class="flex items-start gap-3 p-4 bg-danger-50 border border-danger-200 rounded-xl">' +
                '<svg class="w-5 h-5 text-danger-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>' +
                '<div><p class="font-semibold text-danger-600">' + correctTotal + ' von ' + total + ' richtig, ' + wrongCount + ' leider falsch.</p>' +
                '<p class="text-sm text-danger-500 mt-1">Die richtigen Antworten stehen neben den rot markierten Feldern. Probiere es mit „Nochmal versuchen"!</p></div></div>';
        } else {
            // All wrong
            return '<div class="flex items-start gap-3 p-4 bg-danger-50 border border-danger-200 rounded-xl">' +
                '<svg class="w-5 h-5 text-danger-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>' +
                '<div><p class="font-semibold text-danger-600">Leider keine Lücke korrekt.</p>' +
                '<p class="text-sm text-danger-500 mt-1">Lies den Grundlagentext oben noch einmal durch und versuche es erneut mit „Nochmal versuchen".</p></div></div>';
        }
    }

    // =============================================
    //  GAP TEXT 1
    // =============================================
    function checkGapText() {
        const { exactCount, almostCount, wrongCount } = checkGaps(gap1Answers, gap1Ids);
        const total = gap1Ids.length;
        const feedback = document.getElementById('q5-feedback');
        feedback.classList.remove('hidden');
        feedback.innerHTML = buildFeedbackHTML(exactCount, almostCount, wrongCount, total,
            'Du hast die Kernbegriffe der Metallbindung verstanden.', 'q5');
        if (wrongCount === 0) {
            answeredCorrectly.add('q5');
            document.getElementById('q5-retryBtn').classList.add('hidden');
        } else {
            document.getElementById('q5-retryBtn').classList.remove('hidden');
        }
        updateProgress();
    }

    // =============================================
    //  GAP TEXT 2
    // =============================================
    function checkGapText2() {
        const { exactCount, almostCount, wrongCount } = checkGaps(gap2Answers, gap2Ids);
        const total = gap2Ids.length;
        const feedback = document.getElementById('q6-feedback');
        feedback.classList.remove('hidden');
        feedback.innerHTML = buildFeedbackHTML(exactCount, almostCount, wrongCount, total,
            'Du kennst den Unterschied zwischen Lithium und Beryllium und weißt, was „delokalisiert" bedeutet.', 'q6');
        if (wrongCount === 0) {
            answeredCorrectly.add('q6');
            document.getElementById('q6-retryBtn').classList.add('hidden');
        } else {
            document.getElementById('q6-retryBtn').classList.remove('hidden');
        }
        updateProgress();
    }

    // =============================================
    //  RETRY GAP TEXT
    // =============================================
    function retryGapText(qId) {
        const ids = qId === 'q5' ? gap1Ids : gap2Ids;
        for (const id of ids) {
            const input = document.getElementById(id);
            // Only reset wrong fields
            if (input.classList.contains('incorrect')) {
                input.value = '';
                input.classList.remove('incorrect');
                // remove correction span
                const next = input.nextElementSibling;
                if (next && (next.classList.contains('gap-hint') || next.classList.contains('text-xs'))) next.remove();
            }
        }
        document.getElementById(qId + '-feedback').classList.add('hidden');
        document.getElementById(qId + '-retryBtn').classList.add('hidden');
    }

    // =============================================
    //  TOGGLE SECTIONS
    // =============================================
    function toggleSection(id) {
        const el = document.getElementById(id);
        const chevron = document.getElementById(id + 'Chevron');
        el.classList.toggle('hidden');
        chevron.style.transform = el.classList.contains('hidden') ? '' : 'rotate(180deg)';
    }

    // =============================================
    //  SIMULATION – Elektronengas
    // =============================================
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    let simRunning = false;
    let animFrame = null;

    // High-DPI canvas
    function setupCanvas() {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';
    }

    // Ions (fixed grid)
    const ions = [];
    const electrons = [];
    const ROWS = 4, COLS = 7;

    function initParticles() {
        ions.length = 0;
        electrons.length = 0;
        const rect = canvas.getBoundingClientRect();
        const W = rect.width;
        const H = rect.height;
        const spacingX = W / (COLS + 1);
        const spacingY = H / (ROWS + 1);

        for (let r = 1; r <= ROWS; r++) {
            for (let c = 1; c <= COLS; c++) {
                const offsetX = (r % 2 === 0) ? spacingX * 0.5 : 0;
                ions.push({ x: c * spacingX + offsetX, y: r * spacingY, r: 22 });
            }
        }
        // Electrons
        for (let i = 0; i < 50; i++) {
            electrons.push({
                x: Math.random() * W,
                y: Math.random() * H,
                vx: (Math.random() - 0.5) * 3,
                vy: (Math.random() - 0.5) * 3,
                r: 4
            });
        }
    }

    function drawScene() {
        const rect = canvas.getBoundingClientRect();
        const W = rect.width;
        const H = rect.height;
        ctx.clearRect(0, 0, W, H);

        // Background gradient
        const grad = ctx.createLinearGradient(0, 0, 0, H);
        grad.addColorStop(0, '#0f172a');
        grad.addColorStop(1, '#1e293b');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, W, H);

        // Grid lines (subtle)
        ctx.strokeStyle = 'rgba(148,163,184,0.08)';
        ctx.lineWidth = 1;
        for (let i = 0; i < ions.length; i++) {
            for (let j = i + 1; j < ions.length; j++) {
                const dx = ions[i].x - ions[j].x;
                const dy = ions[i].y - ions[j].y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist < 140) {
                    ctx.beginPath();
                    ctx.moveTo(ions[i].x, ions[i].y);
                    ctx.lineTo(ions[j].x, ions[j].y);
                    ctx.stroke();
                }
            }
        }

        // Electrons (glow + circle)
        for (const e of electrons) {
            // glow
            const glow = ctx.createRadialGradient(e.x, e.y, 0, e.x, e.y, 14);
            glow.addColorStop(0, 'rgba(96,165,250,0.35)');
            glow.addColorStop(1, 'rgba(96,165,250,0)');
            ctx.fillStyle = glow;
            ctx.beginPath();
            ctx.arc(e.x, e.y, 14, 0, Math.PI * 2);
            ctx.fill();
            // body
            ctx.fillStyle = '#60a5fa';
            ctx.beginPath();
            ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
            ctx.fill();
            // highlight
            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            ctx.beginPath();
            ctx.arc(e.x - 1.2, e.y - 1.2, 1.5, 0, Math.PI * 2);
            ctx.fill();
        }

        // Ions
        for (const ion of ions) {
            // outer glow
            const iglow = ctx.createRadialGradient(ion.x, ion.y, ion.r * 0.3, ion.x, ion.y, ion.r * 1.6);
            iglow.addColorStop(0, 'rgba(248,113,113,0.15)');
            iglow.addColorStop(1, 'rgba(248,113,113,0)');
            ctx.fillStyle = iglow;
            ctx.beginPath();
            ctx.arc(ion.x, ion.y, ion.r * 1.6, 0, Math.PI * 2);
            ctx.fill();

            // circle
            ctx.fillStyle = '#1e293b';
            ctx.strokeStyle = '#f87171';
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            ctx.arc(ion.x, ion.y, ion.r, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            // + sign
            ctx.fillStyle = '#f87171';
            ctx.font = 'bold 18px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('+', ion.x, ion.y + 1);
        }
    }

    function updateElectrons() {
        const rect = canvas.getBoundingClientRect();
        const W = rect.width;
        const H = rect.height;
        for (const e of electrons) {
            e.x += e.vx;
            e.y += e.vy;
            // Bounce
            if (e.x < e.r) { e.x = e.r; e.vx *= -1; }
            if (e.x > W - e.r) { e.x = W - e.r; e.vx *= -1; }
            if (e.y < e.r) { e.y = e.r; e.vy *= -1; }
            if (e.y > H - e.r) { e.y = H - e.r; e.vy *= -1; }
            // Slight random jitter
            e.vx += (Math.random() - 0.5) * 0.3;
            e.vy += (Math.random() - 0.5) * 0.3;
            // Speed limit
            const speed = Math.sqrt(e.vx * e.vx + e.vy * e.vy);
            if (speed > 3) { e.vx *= 3 / speed; e.vy *= 3 / speed; }
            // Repel from ions slightly
            for (const ion of ions) {
                const dx = e.x - ion.x;
                const dy = e.y - ion.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist < ion.r + 8 && dist > 0) {
                    e.vx += (dx / dist) * 0.5;
                    e.vy += (dy / dist) * 0.5;
                }
            }
        }
    }

    function animate() {
        if (!simRunning) return;
        updateElectrons();
        drawScene();
        animFrame = requestAnimationFrame(animate);
    }

    function toggleSimulation() {
        const btn = document.getElementById('simStartBtn');
        if (simRunning) {
            simRunning = false;
            cancelAnimationFrame(animFrame);
            btn.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg> Simulation starten';
        } else {
            simRunning = true;
            animate();
            btn.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M6 4h4v16H6zm8 0h4v16h-4z"/></svg> Pause';
        }
    }

    function resetSimulation() {
        simRunning = false;
        cancelAnimationFrame(animFrame);
        const btn = document.getElementById('simStartBtn');
        btn.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg> Simulation starten';
        initParticles();
        drawScene();
    }

    // Init
    window.addEventListener('DOMContentLoaded', () => {
        setupCanvas();
        initParticles();
        drawScene();
    });
    window.addEventListener('resize', () => {
        setupCanvas();
        initParticles();
        drawScene();
    });
    </script>
</body>
</html>
